<tool id="biopython-convert" name="BioPython SeqIO Converter" version="1.0" profile="16.04">
    <requirements>
        <requirement type="package" version="3">python</requirement>
        <requirement type="package">biopython</requirement>
        <requirement type="package">gffutils</requirement>
        <requirement type="package">jmespath</requirement>
    </requirements>
    <version_command><![CDATA[ $__tool_directory__/biopython-convert.py -v ]]></version_command>
    <command detect_errors="aggressive"><![CDATA[
        #if $bioperl
            #set $script = 'bioperl_compat.py'
        #else
            #set $script = 'biopython_convert.py'
        #end if
        #if $split
            mkdir -p output &&
            python $__tool_directory__/$script $split $info
            #if $query
                -q '$query'
            #end if
            $input $input.ext output/record $output_type
        #else
            python $__tool_directory__/$script $split $info
            #if $query
                -q '$query'
            #end if
            $input $input.ext $output $output_type
        #end if
        #if $info
            > $info_output
        #end if
    ]]></command>
    <inputs>
        <param name="input" type="data" format="abi,abi-trim,ace,cif-atom,cif-seqres,clustal,embl,fasta,fasta-2line,fastq-sanger,fastq,fastq-solexa,fastq-illumina,genbank,gb,ig,imgt,nexus,pdb-seqres,pdb-atom,phd,phylip,pir,seqxml,sff,sff-trim,stockholm,swiss,tab,qual,uniprot-xml,gff3" label="Input" />
        <param name="output_type" type="select" label="Output Format">
            <option value="clustal">clustal</option>
            <option value="embl">embl</option>
            <option value="fasta">fasta</option>
            <option value="fasta-2line">fasta-2line</option>
            <option value="fastq-sanger">fastq-sanger</option>
            <option value="fastq">fastq</option>
            <option value="fastq-solexa">fastq-solexa</option>
            <option value="fastq-illumina">fastq-illumina</option>
            <option value="genbank">genbank</option>
            <option value="gb">gb</option>
            <option value="imgt">imgt</option>
            <option value="nexus">nexus</option>
            <option value="phd">phd</option>
            <option value="phylip">phylip</option>
            <option value="pir">pir</option>
            <option value="seqxml">seqxml</option>
            <option value="sff">sff</option>
            <option value="stockholm">stockholm</option>
            <option value="tab">tab</option>
            <option value="qual">qual</option>
            <option value="gff3">gff3</option>
        </param>
        <param name="split" type="boolean" checked="false" truevalue="-s" falsevalue="" label="Split each record into a different file" />
        <param name="info" type="boolean" checked="false" truevalue="-i" falsevalue="" label="Output record information while converting" />
        <param name="query" type="text" label="Query records, keeping only what matches path" help="Provide a JMESPath selecting records to keep. The root is the list of records. The path must return a list of records.">
            <sanitizer>
                <valid initial="string.printable">
                    <remove value="&apos;" />
                </valid>
            </sanitizer>
        </param>
        <param name="bioperl" type="boolean" checked="false" label="Modify biopython to generate files similar to bioperl" />
    </inputs>
    <outputs>
        <data name="info_output" format="tabular" label="Info">
            <filter>info</filter>
        </data>
        <data name="output" format="txt" label="Output">
            <filter>not split</filter>
            <change_format>
                <when input="output_type" value="clustal" format="clustal" />
                <when input="output_type" value="embl" format="embl" />
                <when input="output_type" value="fasta" format="fasta" />
                <when input="output_type" value="fasta-2line" format="fasta-2line" />
                <when input="output_type" value="fastq-sanger" format="fastq-sanger" />
                <when input="output_type" value="fastq" format="fastq" />
                <when input="output_type" value="fastq-solexa" format="fastq-solexa" />
                <when input="output_type" value="fastq-illumina" format="fastq-illumina" />
                <when input="output_type" value="genbank" format="genbank" />
                <when input="output_type" value="gb" format="genbank" />
                <when input="output_type" value="imgt" format="imgt" />
                <when input="output_type" value="nexus" format="nexus" />
                <when input="output_type" value="phd" format="phd" />
                <when input="output_type" value="phylip" format="phylip" />
                <when input="output_type" value="pir" format="pir" />
                <when input="output_type" value="seqxml" format="seqxml" />
                <when input="output_type" value="sff" format="sff" />
                <when input="output_type" value="stockholm" format="stockholm" />
                <when input="output_type" value="tab" format="tabular" />
                <when input="output_type" value="qual" format="qual" />
                <when input="output_type" value="gff3" format="gff3" />
            </change_format>
        </data>
        <collection name="split_output" type="list" label="Output split per record">
            <filter>split</filter>
            <discover_datasets directory="output" format="$output_type" />
        </collection>
    </outputs>
</tool>
