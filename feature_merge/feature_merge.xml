<tool id="feature_merge" name="GFF/GTF Feature Merge" version="1.0" profile="16.04">
    <requirements>
        <!--requirement type="package" version="1.0.0">feature_merge</requirement-->
        <requirement type="package">python</requirement>
        <requirement type="package">gffutils</requirement>
    </requirements>
    <version_command><![CDATA[ $__tool_directory__/feature_merge.py -v ]]></version_command>
    <command detect_errors="aggressive"><![CDATA[
        $__tool_directory__/feature_merge.py $ignore_strand $exclude_components $exact_only -m $merge_strategy
        #for set in $features
            -f "${str($set.csv).replace(" ", "")}"
        #end for
        #for $input in $inputs
            $input
        #end for
        >> $output
    ]]></command>
    <inputs>
        <param name="inputs" type="data" format="gff,gtf" multiple="true" label="Input" />
        <param name="ignore_strand" type="boolean" checked="false" truevalue="-i" falsevalue="" label="Ignore feature strand when merging" argument="-i"/>
        <param name="exclude_components" type="boolean" checked="false" truevalue="" falsevalue="-e" label="Include original feature records in output" argument="-e"/>
        <param name="exact_only" type="boolean" checked="false" truevalue="-x" falsevalue="" label="Only merge features with identical coordinates" argument="-x"/>
        <param name="merge_strategy" type="select" label="ID conflict resolution strategy" argument="-m">
            <option value="merge">merge: attributes of all features with the same primary key will be merged</option>
            <option value="append" selected="true">append: entry will have a unique, autoincremented primary key assigned to it</option>
            <option value="error">error: exception will be raised. This means you will have to edit the file yourself to fix the duplicated IDs</option>
            <option value="skip">skip: ignore duplicates, emitting a warning</option>
            <option value="replace">replace: keep last duplicate</option>
        </param>
        <repeat name="features" title="Specify features to merge" help="Can be provided more than once to specify multiple merge groups. If not provided, all features will be merged.">
            <param name="csv" type="text" label="Feature set to merge" help="Comma seperated types of features to merge. Must be terms or accessions from the SOFA sequence ontology, ALL, or NONE" argument="-f"/>
        </repeat>
    </inputs>
    <outputs>
        <data name="output" format="gff" />
    </outputs>
    <!-- TODO tests -->
    <help><![CDATA[
        https://github.com/brinkmanlab/feature_merge
    ]]></help>
    <citations>
        <!--citation type="doi"></citation-->
    </citations>
</tool>
